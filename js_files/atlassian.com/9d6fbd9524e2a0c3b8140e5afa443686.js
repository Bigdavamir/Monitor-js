WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-directory:space-directory', location = 'js/space-directory.js' */
define("confluence-space-directory/space-directory",["jquery","window","confluence/meta","confluence/legacy","ajs"],function(b,s,n,o,f){return function(){var j=b("#space-directory .aui-nav li"),g=b("#space-search-query"),l=b("#space-search-clear-filter"),p="",q=function(){var a=b("#space-directory .aui-nav-selected");return{type:a.parent().attr("id"),tabName:a.find("a").data("tab-name")}},v=function(){var a=q();return"space-system-list"===a.type&&"all"===a.tabName},t=function(a){a&&a.type&&a.tabName?
b("#"+a.type+" a[data-tab-name="+a.tabName+"]").parent().addClass("aui-nav-selected").attr("aria-current",!0):b("#space-system-list a[data-tab-name=site]").parent().addClass("aui-nav-selected").attr("aria-current",!0)};b("#space-search-result").paginate({nameSpace:"space-directory",url:n.get("context-path")+"/rest/spacedirectory/1/search",cache:!1,pageUrl:n.get("context-path")+"/spacedirectory/view.action",getParams:function(){var a=n.get("remote-user"),c="current",d=[],g;a&&b("#favourites-toggle").hasClass("aui-nav-selected")&&
(d=["~"+a+":favourite","~"+a+":favorite"],b("#space-search-title-bar .space-search-title").text("My Spaces"));a=b(".team-label.aui-nav-selected a");0<a.length&&(d.push("team:"+a.attr("data-tab-name")),c=a.attr("data-status-name"),b("#space-search-title-bar .space-search-title").text(a.text()));d.length||(a=b(".space-type.aui-nav-selected a"),0<a.length&&(g=a.attr("data-type-name"),c=a.attr("data-status-name"),b("#space-search-title-bar .space-search-title").text(a.text())),
g||b("#space-search-title-bar .space-search-title").text("All Spaces"));return{query:p,label:d,type:g,status:c,filterUnauthorizedSpaces:!0}},pageSize:+f.params.pageSize,startIndex:0,preprocess:function(){b(".no-results").addClass("hidden");b("#aui-message-bar").empty()},insertResults:function(a,c,d){var j=a.spaces,k=0===j.length;b(".no-results").toggleClass("hidden",!k||v()&&!g.val());b(".space-list-section").toggleClass("hidden",k);b("#space-directory-help").toggleClass("hidden",
k);var k=Math.floor(d.startIndex/d.pageSize)+1,d=Math.floor(d.totalSize/d.pageSize)+1,a=a.spaces.length,e="",h=b("#space-search-result-status");h.empty();0===a?h.toggleClass("hidden",!0):(e=1<d?f.format("{0}. {1}",f.format("Page {0} of {1}",k,d),f.format("Showing {0} results",a)):f.format("Showing {0} results",a),h.toggleClass("hidden",!1),h.append(e));k=0;for(d=j.length;k<d;k++)if(a=j[k],e=o.Templates.SpaceDirectory.spaceListItem({spaceKey:a.key,
spaceName:a.name,truncatedSpaceName:a.name,spaceDescHtml:a.description,spaceUrl:a.link[1].href,logoUrl:a.logo.href,authenticatedUser:n.get("remote-user"),accessMode:n.get("access-mode")}),e=b(e),c.append(e),h=a.favourite,b(".space-favourites a.aui-iconfont-star-filled",e).toggleClass("hidden",!h),b(".space-favourites a.aui-iconfont-new-star",e).toggleClass("hidden",h),a=a.labels.label,0<a.length){for(var e=b(".space-labels",e),i=h=0,m=a.length;i<m;i++)if("team"===a[i].namespace){var l=b(o.Templates.SpaceDirectory.spaceLabel({spaceLabel:a[i].name}));
2<h?l.addClass("hidden"):h++;e.append(l)}2<h&&e.append(o.Templates.SpaceDirectory.spaceLabelEllipsis())}b(".space-favourites").favourites({})},handleError:function(){f.messages.error({body:"An error occurred while searching for spaces.",closeable:!1})}});var m=function(){b("#space-search-result").hasClass("updating-container")||f.trigger("update-list.space-directory",{startIndex:0});s.localStorage.setItem("lastSelectedSpaceDirectoryTab",JSON.stringify(q()))},i=function(a,b){f.trigger("analytics",{name:"confluence.space-directory."+
a,data:b||{}})};j.click(function(a){var c=b(this);a.preventDefault();j.removeClass("aui-nav-selected");j.removeAttr("aria-current");c.addClass("aui-nav-selected");c.attr("aria-current",!0);m();a=b.trim(c.text()).toLowerCase().replace(/\s/g,"-");c=c.hasClass("team-label")?"category":a+"-filter";i(c+".click",{category:q().tabName})});var r=b("#space-list");r.on("click",".space-name a",function(){i("space.click")});r.on("click",".space-label",function(a){a.preventDefault();j.removeClass("aui-nav-selected");
j.removeAttr("aria-current");b(".team-label a[data-tab-name='"+b(this).text()+"']").parent().addClass("aui-nav-selected");m();i("space.category.click")});r.on("click",".entity-info-icon a",function(){i("space.info.click")});var u;g.keyup(function(){var a=b.trim(g.val());g.hasClass("placeholded")&&(a="");/^\S{1,2}$/.test(a)||(""!==a&&(a=a+" OR "+a+"*"),p!==a&&(p=a,clearTimeout(u),u=setTimeout(function(){m();i("filter")},200)))});b("#space-search-form").submit(function(a){var c=b("#space-list .space-list-item");
if(!b("#space-search-result").hasClass("updating-container")&&1===c.length)return s.location=b(c[0]).find(".space-name a").attr("href"),a.stopPropagation(),!1});l.click(function(a){a.preventDefault();g.val("");g.trigger("keyup");g.focus()});(l=b("#space-directory").data("selected-tab"))?t({type:"space-labels-list",tabName:l}):t(JSON.parse(localStorage.getItem("lastSelectedSpaceDirectoryTab")));m()}});require("confluence/module-exporter").safeRequire("confluence-space-directory/space-directory",function(b){require("ajs").toInit(b)});
}catch(e){WRMCB(e)};