WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.upm.atlassian-universal-plugin-manager-plugin:plugin-notifications', location = 'js/admin-notifications.js' */
(k=>{k.set('upm.notification.no.notifications','No apps require your attention at the moment.');k.set('upm.notification.plugin.notifications','App notifications');})(WRM.I18n.km);
var upm=upm||{};
(function(){function z(){if(f.hasClass("new-notifications")){var a=AJS.$("div.upm-notification","#upm-notifications");for(var b=0,d=a.length;b<d;b++){var c=AJS.$(a[b]);(!c.data("dismissOnClick")||c.data("group")&&!c.data("group").dismissOnClick)&&r(c,!1)}AJS.$("#upm-notifications-trigger").bind("click",k)}}function r(a,b){var d;if(a.hasClass("upm-notification-new")){var c=a.data("notification")||a.data("group");c.dismissed=!0;(d=c.links["post-notifications"])&&AJS.$.ajax({type:"POST",url:d,dataType:"json",
data:JSON.stringify(c),contentType:"application/vnd.atl.plugins+json",success:function(){b&&(a.removeClass("upm-notification-new"),l())}})}}function k(){if(f.hasClass("new-notifications")){var a=AJS.$("div.upm-notification","#upm-notifications");for(var b=0,d=a.length;b<d;b++){var c=AJS.$(a[b]);c.data("dismissed")&&(!c.data("group")||c.data("group").dismissed)||c.data("dismissOnClick")||c.removeClass("upm-notification-new")}l()}AJS.$("#upm-notifications-trigger").unbind("click",k)}function l(){var a=
AJS.$(".upm-notification-new",f).length;a?AJS.$("#upm-notifications-count",f).text(a):f.removeClass("new-notifications")}function A(){var a=AJS.$("#upm-notifications-container");if(a.length)var b=a.removeAttr("href");else if(upm.isJira)(b=AJS.$("#proj-config-return-link")).length?t=!0:(b=AJS.$("#project-config-header ul.operation-menu")).length?u=!0:(b=AJS.$("#project-config-header")).length?m=!0:(b=AJS.$("#admin-page-heading").parent()).length?n=!0:b=AJS.$("#upm-container").find("h2:first");else if(upm.isConfluence){if(-1!=
window.location.href.indexOf("console.action")||-1!=window.location.href.indexOf("editconsolemessages.action")||upm.isUpm)b=AJS.$("#admin-content"),b.length||(b=AJS.$("td.pagebody")),b=AJS.$("\x3cdiv\x3e\x3c/div\x3e").prependTo(b)}else upm.isBamboo||upm.isCrowd?upm.isUpm&&(b=AJS.$("#upm-title")):upm.isFecru?b=AJS.$("#header-admin"):upm.isStash||upm.isBitbucket?b=AJS.$("#content \x3e .aui-tabs \x3e .tabs-menu"):upm.isRefapp&&(b=upm.isUpm?AJS.$("#upm-container").find("h2:first"):AJS.$("#refapp-adminpage-ui"));
return b}function B(a,b){var d=AJS.$('\x3cspan class\x3d"upm-notification-text"\x3e\x3c/span\x3e');b?(d.html(a),d.find("a").attr("href",b)):d.text(a);return d}function C(a){var b=AJS.$('\x3ca id\x3d"upm-notifications-trigger" class\x3d"aui-dd-trigger" href\x3d"#"\x3e\x3cspan id\x3d"upm-notifications-icon"\x3e\x3c/span\x3e\x3c/a\x3e').attr("title",upm.pluginNotificationsTitle);b.bind("click",z);b.bind("click",D);b.bind("focusout",k);a=parseInt(a,10);AJS.$('\x3cspan id\x3d"upm-notifications-count"\x3e\x3c/span\x3e').text(a).appendTo(b);
return b}function v(a,b){var d=b.plugin,c;d.links&&d.links["plugin-icon"]&&(c=AJS.$('\x3cimg src\x3d"" alt\x3d""\x3e').attr("src",d.links["plugin-icon"]).attr("title",d.name));return w(b,a.dismissOnClick,c).data("notification",b)}function w(a,b,d){var c=AJS.$('\x3cdiv class\x3d"upm-notification"\x3e\x3c/div\x3e').attr("id","upm-notification-type-"+a.notificationType),e=AJS.$('\x3cspan class\x3d"upm-notification-icon"\x3e\x3c/span\x3e');d?e.append(d):e.addClass("empty");c.append(e).append(B(a.message,
a.links&&a.links.target));a.dismissed||c.addClass("upm-notification-new");b&&(c.data("dismissOnClick",!0),c.bind("click",function(){r(AJS.$(this),!0)}));return c}function x(){AJS.$.ajax({url:upm.notificationsUrl,type:"get",cache:!1,dataType:"json",contentType:"application/vnd.atl.plugins+json",success:function(a){a=(y=a)&&y.notificationGroups;var b=AJS.$("#upm-notifications-dropdown"),d=0;a&&(d=a.length);b.find("div.upm-notification").remove();b.find("#upm-no-notifications").remove();if(d){for(var c=
0;c<d;c++){var e=a[c];var h=[];if(1===e.notifications.length)h.push(v(e,e.notifications[0]));else if(e.displayIndividually)for(var g=0;g<e.notifications.length;g++)h.push(v(e,e.notifications[g]));else{g=h;var E=g.push,F=AJS.$('\x3cimg src\x3d"" alt\x3d""\x3e').attr("src",e.links["default-icon"]);e=w(e,e.dismissOnClick,F).data("group",e);E.call(g,e)}for(g=0;g<h.length;g++)b.append(h[g])}b.find(".upm-notification-new").length&&(f.addClass("new-notifications"),l())}else AJS.$('\x3cp id\x3d"upm-no-notifications"\x3e\x3c/p\x3e').text(upm.noNotificationsText).appendTo(b);
b.appendTo(f);f.removeClass("hidden").addClass("loaded")},error:function(a){f.addClass("loaded")}})}function G(){if(AJS&&AJS.contextPath)return AJS.contextPath();if(window.contextPath)return window.contextPath;var a=window.location.pathname.split("/plugins/servlet/upm");return a.length?a[0]:""}function D(){var a=window.location.pathname,b=G();b&&(a=a.substr(b.length));a={url:a};upm.analyticsUrl&&(a=a||{},a.type="notification-badge-click",AJS.$.ajax({type:"POST",url:upm.analyticsUrl,dataType:"json",
contentType:"application/vnd.atl.plugins+json",data:JSON.stringify({data:a})}))}function p(){AJS.$(window).unbind("upmready",p);var a=A(),b=(new Date).getTime(),d=AJS.$('\x3cdiv id\x3d"upm-notifications-dropdown" class\x3d"upm-notifications-dropdown aui-dropdown"\x3e\x3c/div\x3e');if(a&&a.length){var c=f=AJS.$('\x3cdiv id\x3d"upm-notifications" class\x3d"aui-dd-parent"\x3e\x3c/div\x3e').bind("refreshNotifications",x).toggleClass("upm-admin-headers",n).toggleClass("upm-project-config",m).toggleClass("upm-operations-headers",
u).toggleClass("upm-action-buttons",t).toggleClass("upm-h1","bamboo"==upm.productId);m?a.before(c):"jira"!=upm.productId||n?a.append(c):a.after(c);f.addClass("hidden upm-notifications-"+upm.productId);C(0).appendTo(f);AJS.$("\x3ch3\x3e\x3c/h3\x3e").text(upm.pluginNotificationsTitle).appendTo(d);d.appendTo(f);1E3<(new Date).getTime()-b&&f.fadeIn();f.dropDown("Standard");AJS.$.ajax({url:upm.rootNotificationsUrl,type:"get",dataType:"json",contentType:"application/vnd.atl.plugins+json",success:function(e){upm.notificationsUrl=
e.links?e.links["my-notifications"]:upm.rootNotificationsUrl;x()},error:function(e){f.addClass("loaded")}})}}var y,f,u=!1,t=!1,n=!1,m=!1;var q=(WRM.data||require("wrm/data")).claim("com.atlassian.upm.atlassian-universal-plugin-manager-plugin:plugin-notifications.notification-data");upm.productId=q.productId;upm.analyticsUrl=q.analyticsUrl;upm.rootNotificationsUrl=q.rootNotificationsUrl;upm.pluginNotificationsTitle=AJS.I18n.getText("upm.notification.plugin.notifications");upm.noNotificationsText=AJS.I18n.getText("upm.notification.no.notifications");
upm.notificationsUrl;upm.isJira="jira"==upm.productId;upm.isBamboo="bamboo"==upm.productId;upm.isConfluence="confluence"==upm.productId;upm.isFecru="fisheye"==upm.productId||"crucible"==upm.productId;upm.isStash="stash"==upm.productId;upm.isBitbucket="bitbucket"==upm.productId;upm.isCrowd="crowd"==upm.productId;upm.isRefapp="refimpl"==upm.productId;AJS.$(window).bind("upmready",p);AJS.toInit(function(){upm.isUpm||p()})})();
}catch(e){WRMCB(e)};